---
abbrlink: ''
categories:
- - 收益的数学原理
- - ChatGPT学习模式
date: '2025-12-10T16:18:47.168285+08:00'
tags:
- 收益影响因素
- 数学原理
- ChatGPT
- 学习模式
title: 做多做空收益的数学原理-ChatGPT学习
updated: '2025-12-10T16:19:54.275+08:00'
---

> 本篇文章主要用于探讨：对于做空的收益，其影响因素都有哪些，有哪些方法在某些前提条件下可以放大收益？
>
> 本篇会在偏数学的层面进行探讨，偏硬核。

前两天看到一篇论坛的精华帖，说的是“单边行情下滚仓对做多做空的影响差异分析”。这不禁让我想起，前两天我自己还在琢磨做空的收益是否永远小于100%这个问题，因为这个结论似乎有点违背我的直觉：这只是单次做空的情况，但实际上，我们交易又不会只做一次。这个问题及其背后的系列问题很有意思！

帖子的作者使用的是偏数学的方法进行的研究，且主要研究了滚仓+单边行情+杠杆1x的情况。但我觉得这背后有些深刻的内容，于是开始拷问GPT。在拷问一番帖子中的那个情况和做法之后，我觉得有必要再整理一篇帖子甚至一系列帖子出来讲讲这个问题，促成了本篇帖子。

我先试着用数学的方式说说这个问题，本期主要讲两个点：

1. 单边价格下跌时，滚仓不限制杠杆做空的收益影响因素；
2. 先单边上涨后单边下跌时，利用马丁格尔方法做空的收益影响因素。

话不多说，直接正题。如果不喜欢看偏数学证明类的东西，直接看1.2节和2.3节开头结论就好～

# 一、单边价格下跌滚仓做空

## 1.1 策略的数学定义

为了讲清楚这个策略的收益，我们首先需要约定一系列前提假设和记号。

首先，单边下跌是什么？对于这个问题，我们需要将随时间变化的连续的价格“离散化”：假设$S_t$是某个标的在第$t$次操作结束后的价格，那么单边下跌的定义就是：

$$
S_0>S_1>\cdots>S_N>0
$$

再记从k到k+1的下跌比例为

$$
r_k:=\frac{S_{k-1}-S_k}{S_{k-1}},0<r_k<1.
$$

于是

$$
S_k=S_{k-1}(1-r_k),\frac{S_N}{S_0}=\prod_{k=1}^N{(1-r_k)}
$$

那我们现在假设该策略初始现金为$W_0$，没有持仓，且杠杆倍数恒定$L>0$。所以第$k$段操作如下（实际上这些操作整体看上去是递归操作）：

1. 在价格$S_{k-1}$处，用融券做空名义金额为

   $$
   Notional_k=L\cdot W_{k-1}
   $$

   的头寸，对应做空数量

   $$
   q_k=\frac{Notional_k}{S_{k-1}}=\frac{LW_{k-1}}{S_{k-1}}
   $$
2. 价格跌到$S_k$的时候平掉空头，收益为

   $$
   Profit_{k}=q_k(S_{k-1}-S_k)=\frac{LW_{k-1}}{S_{k-1}}\cdot S_{k-1}r_k=LW_{k-1}r_k
   $$

   到这里就能看出，第k段的收益与k-1段的现金数量有关，所以是递归过程；
3. 第k次做空结束，更新净资产：

   $$
   W_k=W_{k-1}+Profit_k=W_{k-1}(1+Lr_k).
   $$
4. 然后在$S_k$价格再按同样的杠杆$L$做空，进入下一段。

于是净资产递推式就是

$$
W_k=W_{k-1}(1+Lr_k),k=1,\cdots,N.
$$

所以，在做空的最后，我们一共能获得多少现金？也就是$W_N$：

$$
W_N=W_0\prod_{k=1}^N{(1+Lr_k)}
$$

总收益率$R_{roll}$为：

$$
R_{roll}:=\frac{W_N}{W_0}-1=\prod_{k=1}^N{(1+Lr_k)}-1
$$

这就是在单边下跌路径下的滚仓做空数学收益。那，我们如果想探究总收益大小与哪些因素有关，我们就只需要看上面这个公式中，可以变化的是哪些，不可以变化的是哪些。

## 1.2 收益大小影响因素

> 结论先行：总滚仓收益率只与三个因素有关：每一段价格跌了多少收益率、采用了多大的恒定杠杆、滚仓的频率是多快。下跌的收益率越大、杠杆越大、频率越快，总收益率也就越大。
>
> 如果将上次利润放到下一次继续滚仓，收益会比原有情况增大；而滚仓频率越高，在杠杆倍数大于1的情况下，虽然会比原有收益更大，但有上限。

那其实，在不考虑期初资产的情况下，我们只看总滚仓收益率$R_{roll}$，很容易发现变量只有三个：

+ 每一段的跌幅序列$\{r_k\}$；
+ 杠杆$L$；
+ 滚仓频率（也就是总段数$N$，在给定总跌幅的情况下）

下面我们一个一个来看。

### 1.2.1 单段跌幅$r_k$

想要探究$r_k$对$R_{roll}$的影响，就需要控制变量来看，最好的办法是求个该变量的偏导。$R_{roll}$对$r_k$求偏导，可以得到

$$
\frac{\partial R_{roll}}{\partial r_j}=L\prod_{k=1,k\not =j}^N{(1+Lr_k)}>0.
$$

这个偏导结果大于0，可以得到：任意一段下跌比例$r_j$越大，其他下跌比例不变、杠杆不变、段数不变的情况下，总收益单调增大。如何理解？那就是：每一段跌的越多，这一段的空头赚的就越多；且利润被放到下一段继续放大。

### 1.2.2 杠杆$L$

同样地，我们相用$R_{roll}$对$L$求偏导。但$R_{roll}$的形式过于复杂，所以改用$\ln{(\frac{W_N}{W_0})}$对$L$求偏导，这样可以避免直接对连乘求偏导，更加方便，且因为对数函数的单调性质，其结果仍可以作为参考。我们可以得到偏导如下：

$$
\frac{\partial}{\partial L}\ln{\left(\frac{W_N}{W_0}\right)}=\sum_{k=1}^N{\frac{r_k}{1+Lr_k}}>0
$$

所以，同样道理，杠杆越大，总收益越大。

### 1.2.3 段数$N$

这里的推导十分复杂，我这里直接贴出结论：在连续极限下（无限频率滚仓，维持等杠杆$L$），可以推导出微分形式：

$$
\frac{dW_t}{W_t}=-L\frac{dS_t}{S_t}
$$

积分之后利用微分方程的技巧可得到：

$$
\ln{\frac{W_N}{W_0}}=-L\ln{\frac{S_N}{S_0}}
$$

也就是

$$
\frac{W_N}{W_0}=\left(\frac{S_0}{S_N}\right)^L
$$

这个值是等杠杆滚仓做空在单边下跌中的极限收益，且滚仓频率越高，总收益率越接近$(S_0/S_T)^L-1$。

注意哦，这个收益乍一看有点懵，心想：是不是和单次做空的收益一样呢？但仔细一想就会发现：单次做空，直接从$S_0$到$S_N$的收益，应该是

$$
L\left(\frac{S_0}{S_N}-1\right)
$$

那由于$S_0>S_N$，由线性函数和指数函数的知识可以知道，多次比单次的收益大了不止一点半点，尤其在初始价格和最终价格差距过大的时候！

但同时，滚仓频率越高，高到一定程度后，边际收益是在递减的。

# 二、先涨后跌马丁格尔做空

> 为什么我想用马丁格尔来说明先涨后跌的情形？
>
> 因为我们知道，单边滚仓肯定比先上涨后下跌的滚仓收益，在一般情况下要大，所以这两者的比较基本没有意义（一般人也不会做后者这样的操作）；但币圈中，大多交易所有一个玩法是合约马丁格尔，同时我觉得，在先上涨后下跌的行情中，使用马丁格尔进行加仓并在最后卖出是一种明智的选择，所以采用马丁格尔进行说明。
>
> 马丁格尔是一种浮亏不断加仓的技术，赚取的是先涨后跌的钱。

## 2.1 路径的数学定义

首先，我们用离散网格的方式描述价格：

+ 初始价格是$S_0$；
+ 先以固定收益率不断上涨，每一步上涨比例为$\delta>0$，可以理解为每次涨1%或者2%这种固定比率：

  $$
  S_i=S_0(1+\delta)^i
  $$

  其中i为0到U之间的某个正整数，U代表最高点。
+ 最高点可以计算为

  $$
  S_U=S_0(1+\delta)^U.
  $$
+ 随后转为下跌，最终落到某个$S_f<S_0$。为了简化模型，我们假定在回落过程中，不再加仓，只在$S_f$一次性平仓。

## 2.2 马丁格尔加仓做空的规则

马丁格尔的规则如下：

1. 在$S_0$做空$q_0$股；
2. 每当价格向上走一个档位，到达$S_1,S_2,\cdots,S_U$时，额外做空一笔

   $$
   q_i=q_0m^i(i=1,2,\cdots,U)
   $$

   股，其中m为固定数值，为加仓倍数。注意，这个不是杠杆，是后一次股数相对于前一次股数的倍数；
3. 从始至终不在回落阶段加仓，只在最终价格$S_f$一次性平掉所有空单。

这样，当上涨到最高点时，空头的数量（注意是数量不是金额，股票对应股数，币代表币种数量）为：

$$
Q_{tot}=\sum_{t=0}^U{q_i}=q_0\sum_{i=0}^{U}m^i=q_0\frac{m^{U+1}-1}{m-1}
$$

+ 总卖出收入

  $$
  Sell=\sum_{i=0}^U{q_iS_i}=\sum_{i=0}^{U}{q_0m^iS_0(1+\delta)^i=q_0S_0\sum_{i=0}^U{(m(1+\delta))^i}}.
  $$
+ 在$S_f$一次性买入平仓的总成本

  $$
  Buy=Q_{tot}S_f=q_0\frac{m^{U+1}-1}{m-1}S_f.
  $$

因此，策略的总利润为

$$
\Pi_{mart}=Sell-Buy=q_0S_0\frac{(m(1+\delta))^{U+1}-1}{(m(1+\delta))-1}-q_0S_f\frac{m^{U+1}-1}{m-1}
$$

这个公式太不直观了，我们希望将其写作

$$
\Pi_{mart}=Q_{tot}(\bar{S}_{in}-S_f).\tag{1}
$$

的形式，其中$\bar{S}_{in}$为平均开仓价格，$Q_{tot}$为总仓位，那么由上面的内容可知$\bar{S}_{in}$可以写作：

$$
\bar{S}_{in}:=\frac{\sum_{i=0}^U{q_iS_i}}{\sum_{i=0}^U{q_i}}=\frac{\sum_{i=0}^U{q_0m^iS_i}}{Q_{tot}}.
$$

由于越涨越加仓，所以

$$
\bar{S}_{in}>S_0
$$

也就是加权平均开仓价一定高于初始价。这一点从数学上可以推导。

## 2.3 马丁收益影响因素

> 结论先行：
>
> 1. 在“反转最终成功且你没爆仓”的前提下，上涨越深（越痛），最后的收益越大，这是马丁加仓的典型特征；
> 2. 下跌终点越低，收益越大，且下跌终点在某些条件下可以比起点高；
> 3. 加仓倍数（马丁倍数）m越大，最终盈利潜力几乎以“比指数还猛”的力度往上冲。

### 2.3.1 上涨幅度$U,\delta$

在其他变量不变的情况下，上涨越高（$U$越大或者$\delta$越大），对马丁策略有两重影响：

+ 仓位更重：

  $$
  Q_{tot}=q_0\frac{m^{U+1}-1}{m-1}
  $$

  随$U$呈现指数增长；
+ 有效开仓均价越高：$\bar{S}_{in}$是以$m^i$权重加权的平均价，权重偏向于高价区间，所以随$U,\delta$的增大单调上升。

而$\bar{S}_{in}$越高，收益越高，所以上涨越深（越痛），最后的收益越大，这是马丁加仓的典型特征。

### 2.3.2 下跌终点$S_f$

由式$(1)$可知，给定$\bar{S}_{in}$和$Q_{tot}$之后，收益随$S_f$的关系简单明了：

$$
\frac{\partial \Pi_{mart}}{\partial S_f}=-Q_{tot}<0
$$

也就是：S_f跌的越低，$\Pi_{mart}$线性增大。这是所有做空策略共有的线性单调性。同时，由于$\bar{S}_{in}$比$S_0$高，这两者之间有距离，所以就算$S_f$比$S_0$高，只要同时比$\bar{S}_{in}$要低，收益就是正的。这也就是下跌终点在某些条件下可以比起点高的条件和原因。

### 2.3.3 马丁倍数$m$

首先，

$$
Q_{tot}(m)=q_0\frac{m^{U+1}-1}{m-1}
$$

该函数对于$m$明显是凸的，且快速增长。

其次，$\bar{S}_{in}$中权重$m^i$越偏向高位，$m$越大，$\bar{S}_{in}$越靠近最高价$S_U$。因此，在不考虑爆仓等约束，只看数学形式上，

$$
\Pi_{mart}(m)=Q_{tot}(m)(\bar{S}_{in}(m)-S_f)
$$

是一个随m增大而大幅上升的函数，简单来讲：在条件性存活的前提下，马丁倍数$m$越大，最终盈利潜力几乎以“比指数还猛”的力度往上冲。

# 三、小结

本篇想说明的核心，其实只有一句话：做空的收益并不是最多100%，做空的收益问题是一个依赖于路径、频率、仓位规则等等的动态问题。

第一部分说明：在不爆仓、能无限细分路径、并且每一段都能按恒定杠杆完美执行的理想世界里，只要标的价格可以足够接近 0，做空的复利收益在数学上是可以远远超过 100% 的。所谓“做空最多赚 100%”，只是针对“从 1 做到 0、且只做一笔”的特例。

进一步地，等杠杆滚仓的收益只由三件事决定：每一小段的跌幅序列$\{r_k\}$、所用杠杆$L$，以及滚仓频率（段数$N$）。跌得越多、杠杆越大、滚得越勤，在模型假设下总收益就越高，并在频率趋于无穷时逼近一个上限。这其实和“把收益再投回去”的复利逻辑是一致的，只是这里的“本金放大”是通过价格路径和杠杆共同驱动的。本质上，第一部分的单边下跌滚仓做空就是用复利的方式放大收益。

第二部分，我们介绍了马丁格尔策略，并针对马丁格尔也有相应的结论：涨得越狠（自己越疼），只要最终真能反转并坚持活到终点，盈利的弹性就越大；马丁倍数越大，盈利潜力以接近“爆炸式”的方式上升（但同样，爆仓风险也在用类似的速度逼近）。
